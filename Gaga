# =================================================================================
#
#   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
#  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
#  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
#  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
#  â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•
#
# =================================================================================
#
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
# â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
# â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
# â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
#  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•
#
# =================================================================================
#
# ğŸš€ ĞœĞĞ©ĞĞ«Ğ™ Ğ§ĞĞ¢-ĞœĞĞ”Ğ£Ğ›Ğ¬ ĞĞ¢ ADAMANT
# ğŸ’ Ğ’Ğ•Ğ Ğ¡Ğ˜Ğ¯: ULTRA-PRO MAX | 2025
#
# =================================================================================
# meta developer: @adamantinesss
# =================================================================================
# âš ï¸ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ”Ğ›Ğ¯ PRO-ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ•Ğ™
# =================================================================================
from .. import loader, utils
from asyncio import sleep
from telethon.tl.types import Message
from typing import Optional


@loader.tds
class Minebiznesbot(loader.Module):
    """ĞšĞ¾Ğ¿Ğ°Ğ»ĞºĞ°, Ğ¸ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒĞ½Ğ¸Ğº. | by @adamantinesss"""

    strings = {
        "name": "MineBB",
        "started": "<emoji document_id=5188488289350330143>â›</emoji>ğŸ”‡ <b>Ğ ĞµĞ¶Ğ¸Ğ¼ ĞºĞ¾Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½</b> (ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ÑÑ‚ÑÑ Ğ±ĞµĞ· ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹)",
        "stopped": "<emoji document_id=5377366434038952966>ğŸ˜ </emoji> <b>ĞšĞ¾Ğ¿ĞºĞ° Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°</b>",
        "error": "<emoji document_id=5377828362066603436>ğŸ˜¬</emoji> <b>ĞÑˆĞ¸Ğ±ĞºĞ°:</b> {}",
        "no_reply": "<emoji document_id=5377859487694598643>ğŸ¤·â€â™‚ï¸</emoji> <b>ĞÑ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸!</b>",
        "no_buttons": "<emoji document_id=5377859487694598643>ğŸ¤·â€â™‚ï¸</emoji> <b>ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹</b>",
        "config_info": "<emoji document_id=5341715473882955310>âš™ï¸</emoji> <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:</b>\nĞšĞ½Ğ¾Ğ¿ĞºĞ¸: {}\nĞ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»: {} ÑĞµĞº",
    }

    def __init__(self):
        self.active = False
        self.config = loader.ModuleConfig(
            "BUTTONS", ["ĞšĞ¾Ğ¿Ğ°Ñ‚ÑŒ", "ğŸ‘‡"], lambda: "ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ñ (Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ)"
        )
        self.interval = 2

    async def client_ready(self, client, db):
        self.client = client
        self._db = db

    async def _click_silently(self, msg: Message) -> bool:
        """ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"""
        try:
            if not msg or not hasattr(msg, "buttons"):
                return False

            clicked = False
            for btn_text in self.config["BUTTONS"]:
                for row in msg.buttons:
                    for button in row:
                        if btn_text.lower() in button.text.lower():
                            await button.click()
                            clicked = True
                            await sleep(2.5)  # Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ»Ğ¸ĞºĞ°Ğ¼Ğ¸
            return clicked
        except Exception:
            return False

    async def minecmd(self, message: Message):
        """Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ñ…Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ | .amine (Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ½Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ)"""
        reply = await message.get_reply_message()
        if not reply:
            await utils.answer(message, self.strings["no_reply"])
            return

        if self.active:
            await utils.answer(
                message,
                "<emoji document_id=5188488289350330143>â›</emoji> <b>ĞšĞ¾Ğ¿Ğ°ĞµÑ‚!</b>",
            )
            return

        self.active = True
        await utils.answer(message, self.strings["started"])

        while self.active:
            try:
                fresh_msg = await self.client.get_messages(
                    entity=reply.peer_id, ids=reply.id
                )

                if not await self._click_silently(fresh_msg):
                    if not self.active:  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¸ ĞºĞ»Ğ¸ĞºĞµÑ€
                        break
                    await utils.answer(message, self.strings["no_buttons"])
                    self.active = False
                    break

                await sleep(self.interval)
            except Exception as e:
                if self.active:  # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞºĞµÑ€ Ğ½Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
                    await utils.answer(message, self.strings["error"].format(e))
                await sleep(3)

    async def amstopcmd(self, message: Message):
        """ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ | .amstop"""
        if not self.active:
            await utils.answer(
                message,
                "<emoji document_id=5379846932271214613>ğŸ¤©</emoji> <b>ĞŸĞµÑ€ĞµÑÑ‚Ğ°Ğ» ĞºĞ¾Ğ¿Ğ°Ñ‚ÑŒ!</b>",
            )
            return

        self.active = False
        await utils.answer(message, self.strings["stopped"])

    async def aconfigcmd(self, message: Message):
        """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ | .aconfig <ĞºĞ½Ğ¾Ğ¿ĞºĞ¸> <Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»>"""
        args = utils.get_args_raw(message)

        if not args:
            await utils.answer(
                message,
                self.strings["config_info"].format(
                    ", ".join(self.config["BUTTONS"]), self.interval
                ),
            )
            return

        try:
            buttons, interval = map(str.strip, args.rsplit(" ", 1))
            self.config["BUTTONS"] = [btn.strip() for btn in buttons.split(",")]
            self.interval = max(0.5, float(interval))  # ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 0.5 ÑĞµĞº
            await utils.answer(
                message,
                "<emoji document_id=5276137623990064671>âš¡ï¸</emoji> <b>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹!</b>",
            )
        except:
            await utils.answer(
                message,
                "<emoji document_id=5190443891039417869>ğŸ™ˆ</emoji> <b>ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚!</b>\nĞŸÑ€Ğ¸Ğ¼ĞµÑ€: <code>.aconfig ĞšĞ½Ğ¾Ğ¿ĞºĞ°1,ĞšĞ½Ğ¾Ğ¿ĞºĞ°2 3</code>",
            )
